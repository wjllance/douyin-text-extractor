# ğŸ§ª æŠ–éŸ³ API æµ‹è¯•ä½¿ç”¨è¯´æ˜

æœ¬é¡¹ç›®æä¾›äº†å¤šç§æµ‹è¯•å·¥å…·æ¥éªŒè¯æŠ–éŸ³è§†é¢‘æ–‡æœ¬æå– API çš„åŠŸèƒ½ã€‚

## ğŸ“ æµ‹è¯•æ–‡ä»¶è¯´æ˜

### 1. `test-script.js` - Node.js æµ‹è¯•è„šæœ¬

- **åŠŸèƒ½**: å®Œæ•´çš„ API åŠŸèƒ½æµ‹è¯•å·¥å…·
- **ç‰¹ç‚¹**: å½©è‰²è¾“å‡ºã€è¯¦ç»†æ—¥å¿—ã€æ€§èƒ½æµ‹é‡
- **ä¾èµ–**: Node.js, axios

### 2. `test.sh` - Bash æµ‹è¯•è„šæœ¬

- **åŠŸèƒ½**: ä½¿ç”¨ curl çš„è½»é‡çº§æµ‹è¯•å·¥å…·
- **ç‰¹ç‚¹**: æ— éœ€ Node.js ç¯å¢ƒã€JSON æ ¼å¼åŒ–è¾“å‡º
- **ä¾èµ–**: bash, curl, jq(å¯é€‰)

### 3. `example-test.js` - ç¤ºä¾‹æµ‹è¯•è„šæœ¬

- **åŠŸèƒ½**: æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨æµ‹è¯•å·¥å…·çš„ç¤ºä¾‹ä»£ç 
- **ç‰¹ç‚¹**: æ•™å­¦ç¤ºä¾‹ã€å¤šç§æµ‹è¯•åœºæ™¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¯åŠ¨æœåŠ¡

é¦–å…ˆç¡®ä¿ API æœåŠ¡æ­£åœ¨è¿è¡Œï¼š

```bash
# å¼€å‘æ¨¡å¼å¯åŠ¨
npm run dev

# æˆ–è€…ç¼–è¯‘åå¯åŠ¨
npm run build
npm start
```

### åŸºç¡€æµ‹è¯•ï¼ˆæ— éœ€ API å¯†é’¥ï¼‰

```bash
# ä½¿ç”¨Node.jsè„šæœ¬æµ‹è¯•ï¼ˆè·³è¿‡æ–‡æœ¬æå–ï¼‰
node test-script.js "https://v.douyin.com/xxx" --skip-text

# ä½¿ç”¨bashè„šæœ¬æµ‹è¯•
./test.sh "https://v.douyin.com/xxx" --skip-text
```

### å®Œæ•´æµ‹è¯•ï¼ˆéœ€è¦ API å¯†é’¥ï¼‰

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export SPEECH_API_KEY="your-siliconflow-api-key"

# è¿è¡Œå®Œæ•´æµ‹è¯•
node test-script.js "https://v.douyin.com/xxx"
./test.sh "https://v.douyin.com/xxx"
```

## ğŸ“‹ æµ‹è¯•åŠŸèƒ½è¦†ç›–

### 1. æœåŠ¡å¥åº·æ£€æŸ¥

- **ç«¯ç‚¹**: `GET /health`
- **éªŒè¯**: æœåŠ¡çŠ¶æ€ã€ç‰ˆæœ¬ä¿¡æ¯
- **é¢„æœŸ**: 200 çŠ¶æ€ç ã€æ­£ç¡®çš„ JSON å“åº”

### 2. API ä¿¡æ¯è·å–

- **ç«¯ç‚¹**: `GET /api/info`
- **éªŒè¯**: API æè¿°ã€å¯ç”¨ç«¯ç‚¹åˆ—è¡¨
- **é¢„æœŸ**: å®Œæ•´çš„ API æ–‡æ¡£ä¿¡æ¯

### 3. é“¾æ¥è§£ææµ‹è¯•

- **ç«¯ç‚¹**: `POST /api/parse`
- **éªŒè¯**: æŠ–éŸ³é“¾æ¥è§£æã€è§†é¢‘ä¿¡æ¯æå–
- **é¢„æœŸ**: è§†é¢‘ IDã€æ ‡é¢˜ã€æè¿°ã€ä¸‹è½½é“¾æ¥

### 4. ä¸‹è½½é“¾æ¥è·å–

- **ç«¯ç‚¹**: `POST /api/download-link`
- **éªŒè¯**: æ— æ°´å°ä¸‹è½½é“¾æ¥ç”Ÿæˆ
- **é¢„æœŸ**: å¯ç”¨çš„è§†é¢‘ä¸‹è½½åœ°å€

### 5. æ–‡æœ¬æå–æµ‹è¯•

- **ç«¯ç‚¹**: `POST /api/extract-text`
- **éªŒè¯**: å®Œæ•´çš„è§†é¢‘è½¬æ–‡æœ¬æµç¨‹
- **é¢„æœŸ**: æå–çš„æ–‡æœ¬å†…å®¹ã€å¤„ç†æ—¶é—´

## ğŸ”§ æµ‹è¯•è„šæœ¬é€‰é¡¹

### Node.js è„šæœ¬é€‰é¡¹

```bash
node test-script.js <æŠ–éŸ³é“¾æ¥> [é€‰é¡¹]

é€‰é¡¹:
  --skip-text     è·³è¿‡æ–‡æœ¬æå–æµ‹è¯•
  --api-url URL   æŒ‡å®šAPIæœåŠ¡åœ°å€
  --help          æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

### Bash è„šæœ¬é€‰é¡¹

```bash
./test.sh <æŠ–éŸ³é“¾æ¥> [é€‰é¡¹]

é€‰é¡¹:
  --skip-text     è·³è¿‡æ–‡æœ¬æå–æµ‹è¯•
  --api-url URL   æŒ‡å®šAPIæœåŠ¡åœ°å€
  --help          æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

## ğŸŒ ç¯å¢ƒå˜é‡é…ç½®

| å˜é‡å           | è¯´æ˜              | é»˜è®¤å€¼                  | å¿…éœ€              |
| ---------------- | ----------------- | ----------------------- | ----------------- |
| `API_BASE_URL`   | API æœåŠ¡åœ°å€      | `http://localhost:3000` | âŒ                |
| `SPEECH_API_KEY` | è¯­éŸ³è¯†åˆ« API å¯†é’¥ | æ—                       | âœ… (æ–‡æœ¬æå–åŠŸèƒ½) |

## ğŸ“Š æµ‹è¯•è¾“å‡ºç¤ºä¾‹

### æˆåŠŸçš„æµ‹è¯•è¾“å‡º

```
ğŸš€ å¼€å§‹æŠ–éŸ³è§†é¢‘å¤„ç†åŠŸèƒ½æµ‹è¯•
==================================================

ğŸ“‹ æ­¥éª¤ 1: æµ‹è¯•æœåŠ¡å¥åº·çŠ¶æ€
âœ… æœåŠ¡çŠ¶æ€: success
â„¹ï¸  ç‰ˆæœ¬: 1.0.0

ğŸ“‹ æ­¥éª¤ 2: è·å–APIä¿¡æ¯
âœ… APIåç§°: Douyin Video Text Extraction API
â„¹ï¸  æè¿°: Node.js + TypeScript API for extracting text from Douyin videos

ğŸ“‹ æ­¥éª¤ 3: è§£ææŠ–éŸ³é“¾æ¥
âœ… é“¾æ¥è§£ææˆåŠŸ (1205ms)
â„¹ï¸  è§†é¢‘ID: 7234567890123456789
â„¹ï¸  æ ‡é¢˜: ç¤ºä¾‹è§†é¢‘æ ‡é¢˜
â„¹ï¸  ä¸‹è½½é“¾æ¥: https://example.com/video.mp4...

ğŸ“‹ æ­¥éª¤ 4: è·å–ä¸‹è½½é“¾æ¥
âœ… è·å–ä¸‹è½½é“¾æ¥æˆåŠŸ (856ms)
â„¹ï¸  ä½¿ç”¨æç¤º: å¯ä»¥ç›´æ¥ä½¿ç”¨æ­¤é“¾æ¥ä¸‹è½½æ— æ°´å°è§†é¢‘

ğŸ“‹ æ­¥éª¤ 5: æå–è§†é¢‘æ–‡æœ¬
â„¹ï¸  å¼€å§‹æ–‡æœ¬æå–æµç¨‹ï¼Œè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´...
âœ… æ–‡æœ¬æå–æˆåŠŸ (15230ms)
â„¹ï¸  æå–çš„æ–‡æœ¬: "è¿™æ˜¯ä»è§†é¢‘ä¸­æå–çš„æ–‡æœ¬å†…å®¹"

ğŸ“Š æµ‹è¯•ç»“æœæ€»ç»“
==================================================
âœ… å¥åº·æ£€æŸ¥: é€šè¿‡
âœ… APIä¿¡æ¯: é€šè¿‡
âœ… é“¾æ¥è§£æ: é€šè¿‡
âœ… ä¸‹è½½é“¾æ¥: é€šè¿‡
âœ… æ–‡æœ¬æå–: é€šè¿‡

ğŸ¯ æµ‹è¯•å®Œæˆ: 5/5 é¡¹é€šè¿‡
```

## ğŸš¨ å¸¸è§é”™è¯¯ä¸è§£å†³

### 1. æœåŠ¡è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:

```
âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡ï¼Œè¯·ç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œåœ¨ http://localhost:3000
```

**è§£å†³æ–¹æ³•**:

- ç¡®è®¤ API æœåŠ¡å·²å¯åŠ¨: `npm run dev`
- æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®
- ç¡®è®¤é˜²ç«å¢™è®¾ç½®

### 2. API å¯†é’¥æœªè®¾ç½®

**é”™è¯¯ä¿¡æ¯**:

```
âŒ æœªè®¾ç½®è¯­éŸ³è¯†åˆ«APIå¯†é’¥ï¼Œè¯·åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½® SPEECH_API_KEY
```

**è§£å†³æ–¹æ³•**:

```bash
export SPEECH_API_KEY="your-api-key"
# æˆ–åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½®
echo "SPEECH_API_KEY=your-api-key" >> .env
```

### 3. é“¾æ¥è§£æå¤±è´¥

**é”™è¯¯ä¿¡æ¯**:

```
âŒ è§£ææŠ–éŸ³é“¾æ¥å¤±è´¥: æœªæ‰¾åˆ°æœ‰æ•ˆçš„åˆ†äº«é“¾æ¥
```

**è§£å†³æ–¹æ³•**:

- ç¡®è®¤ä½¿ç”¨çš„æ˜¯æœ‰æ•ˆçš„æŠ–éŸ³åˆ†äº«é“¾æ¥
- æ£€æŸ¥é“¾æ¥æ ¼å¼æ˜¯å¦æ­£ç¡®
- å°è¯•ä½¿ç”¨æœ€æ–°çš„åˆ†äº«é“¾æ¥

### 4. FFmpeg ç›¸å…³é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:

```
âŒ æå–éŸ³é¢‘å¤±è´¥: Cannot find ffmpeg
```

**è§£å†³æ–¹æ³•**:

```bash
# macOS
brew install ffmpeg

# Ubuntu/Debian
sudo apt install ffmpeg

# ç¡®è®¤å®‰è£…
ffmpeg -version
```

## ğŸ”„ æŒç»­é›†æˆæµ‹è¯•

### GitHub Actions ç¤ºä¾‹

```yaml
name: API Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: "18"

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
          npm install

      - name: Build project
        run: npm run build

      - name: Start API server
        run: npm start &

      - name: Wait for server
        run: sleep 10

      - name: Run basic tests
        run: node test-script.js "https://v.douyin.com/example" --skip-text
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†æµ‹è¯•

### é¢„æœŸæ€§èƒ½æŒ‡æ ‡

| æ“ä½œ     | é¢„æœŸæ—¶é—´ | å¤‡æ³¨           |
| -------- | -------- | -------------- |
| å¥åº·æ£€æŸ¥ | < 100ms  | æœ¬åœ°å“åº”       |
| API ä¿¡æ¯ | < 100ms  | é™æ€æ•°æ®       |
| é“¾æ¥è§£æ | < 2s     | ç½‘ç»œè¯·æ±‚       |
| ä¸‹è½½é“¾æ¥ | < 2s     | ç½‘ç»œè¯·æ±‚       |
| æ–‡æœ¬æå– | 10-60s   | å–å†³äºè§†é¢‘é•¿åº¦ |

### æ€§èƒ½æµ‹è¯•è„šæœ¬

```bash
# è¿è¡Œå¤šæ¬¡æµ‹è¯•è®¡ç®—å¹³å‡æ—¶é—´
for i in {1..5}; do
  echo "=== æµ‹è¯•è½®æ¬¡ $i ==="
  node test-script.js "https://v.douyin.com/xxx" --skip-text
done
```

## ğŸ¯ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‰å‡†å¤‡

- ç¡®ä¿æœåŠ¡å·²å¯åŠ¨ä¸”ç¨³å®šè¿è¡Œ
- å‡†å¤‡æœ‰æ•ˆçš„æŠ–éŸ³åˆ†äº«é“¾æ¥
- è®¾ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡

### 2. æµ‹è¯•ç­–ç•¥

- å…ˆè¿è¡ŒåŸºç¡€åŠŸèƒ½æµ‹è¯•ï¼ˆä¸éœ€è¦ API å¯†é’¥ï¼‰
- å†è¿è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•ï¼ˆéœ€è¦ API å¯†é’¥ï¼‰
- ä½¿ç”¨ä¸åŒç±»å‹çš„è§†é¢‘é“¾æ¥è¿›è¡Œæµ‹è¯•

### 3. é”™è¯¯å¤„ç†

- ä»”ç»†é˜…è¯»é”™è¯¯ä¿¡æ¯
- æ£€æŸ¥æ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†ä¿¡æ¯
- é€æ­¥æ’æŸ¥é—®é¢˜æ ¹æº

### 4. æ€§èƒ½ä¼˜åŒ–

- ç›‘æ§å“åº”æ—¶é—´
- å…³æ³¨å†…å­˜ä½¿ç”¨æƒ…å†µ
- å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶

---

ğŸ’¡ **æç¤º**: å»ºè®®åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸è¿è¡Œæµ‹è¯•ï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸ã€‚å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å¹¶å‚è€ƒæ•…éšœæ’é™¤æŒ‡å—ã€‚
