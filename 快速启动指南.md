# 抖音视频文本提取 API - 快速启动指南

## 🚀 快速开始

### 1. 环境准备

确保你的系统已安装：

- **Node.js 16+**
- **FFmpeg** (音视频处理必需)
- **语音识别 API 密钥** (如 SiliconFlow)

### 2. 安装 FFmpeg

```bash
# macOS
brew install ffmpeg

# Ubuntu/Debian
sudo apt update && sudo apt install ffmpeg

# Windows - 下载安装包
# https://ffmpeg.org/download.html
```

### 3. 项目设置

```bash
# 1. 进入项目目录
cd douyin-nodejs-api

# 2. 安装依赖
npm install

# 3. 配置环境变量
cp env.example .env

# 4. 编辑 .env 文件，设置你的 API 密钥
# SPEECH_API_KEY=your-siliconflow-api-key
```

### 4. 运行项目

```bash
# 开发模式（推荐）
npm run dev

# 或者编译后运行
npm run build
npm start
```

### 5. 测试 API

服务启动后，访问：

- **健康检查**: http://localhost:3000/health
- **API 文档**: http://localhost:3000/api/info

## 📝 API 使用示例

### 1. 解析抖音链接

```bash
curl -X POST http://localhost:3000/api/parse \
  -H "Content-Type: application/json" \
  -d '{"shareLink": "https://v.douyin.com/xxx"}'
```

### 2. 获取下载链接

```bash
curl -X POST http://localhost:3000/api/download-link \
  -H "Content-Type: application/json" \
  -d '{"shareLink": "https://v.douyin.com/xxx"}'
```

### 3. 提取视频文本（需要 API 密钥）

```bash
curl -X POST http://localhost:3000/api/extract-text \
  -H "Content-Type: application/json" \
  -d '{"shareLink": "https://v.douyin.com/xxx"}'
```

## 🐳 Docker 部署

### 快速部署

```bash
# 1. 设置环境变量
echo "SPEECH_API_KEY=your-api-key" > .env

# 2. 启动服务
docker-compose up -d

# 3. 查看日志
docker-compose logs -f
```

### 手动 Docker 构建

```bash
# 1. 构建镜像
docker build -t douyin-api .

# 2. 运行容器
docker run -d \
  -p 3000:3000 \
  -e SPEECH_API_KEY=your-api-key \
  --name douyin-api \
  douyin-api
```

## 🔧 配置说明

### 必需配置

| 环境变量         | 说明              | 示例     |
| ---------------- | ----------------- | -------- |
| `SPEECH_API_KEY` | 语音识别 API 密钥 | `sk-xxx` |

### 可选配置

| 环境变量              | 默认值                        | 说明              |
| --------------------- | ----------------------------- | ----------------- |
| `PORT`                | `3000`                        | 服务端口          |
| `NODE_ENV`            | `development`                 | 运行环境          |
| `SPEECH_API_BASE_URL` | SiliconFlow API               | 语音识别 API 地址 |
| `SPEECH_MODEL`        | `FunAudioLLM/SenseVoiceSmall` | 语音识别模型      |
| `TEMP_DIR`            | `./temp`                      | 临时文件目录      |
| `LOG_LEVEL`           | `info`                        | 日志级别          |

## 🛠️ 开发指南

### 代码检查

```bash
# TypeScript 编译检查
npm run build

# ESLint 代码检查
npm run lint

# 自动修复代码风格
npm run lint:fix
```

### 项目结构

```
src/
├── config/           # 配置管理
├── controllers/      # HTTP 控制器
├── middleware/       # Express 中间件
├── services/         # 业务逻辑服务
├── types/           # TypeScript 类型定义
├── utils/           # 工具函数
└── index.ts         # 应用入口
```

## 🔍 故障排除

### 常见问题

1. **FFmpeg 未找到**

   ```
   Error: Cannot find ffmpeg
   ```

   **解决**: 确保 FFmpeg 已安装并在 PATH 中

2. **API 密钥错误**

   ```
   未设置语音识别API密钥
   ```

   **解决**: 检查 `.env` 文件中的 `SPEECH_API_KEY`

3. **端口被占用**

   ```
   Error: listen EADDRINUSE :::3000
   ```

   **解决**: 更改 `PORT` 环境变量或停止占用端口的进程

4. **临时文件过多**
   - 系统会自动清理 1 小时前的临时文件
   - 手动清理: `rm -rf temp/*`

### 日志查看

```bash
# 开发环境 - 控制台输出
npm run dev

# 生产环境 - 文件日志
tail -f logs/combined.log
tail -f logs/error.log
```

## 📊 性能监控

### 关键指标

- **响应时间**: 链接解析 < 1s，完整流程 < 30s
- **内存使用**: 建议 1GB+ 可用内存
- **磁盘空间**: 临时文件会自动清理
- **并发处理**: 建议限制并发数避免资源耗尽

### 优化建议

1. **生产环境**使用 PM2 或 Docker 部署
2. **负载均衡**处理高并发请求
3. **监控日志**及时发现问题
4. **定期清理**临时文件和日志

## 🆘 获取帮助

- **查看日志**: `npm run dev` 查看详细错误信息
- **API 文档**: 访问 `/api/info` 获取完整接口说明
- **健康检查**: 访问 `/health` 确认服务状态

## 🎯 下一步

1. **集成到你的应用**: 使用 REST API 调用
2. **自定义配置**: 根据需求调整参数
3. **监控部署**: 设置日志和性能监控
4. **扩展功能**: 基于现有代码添加新特性

---

**提示**: 首次使用建议先在开发环境测试，确认功能正常后再部署到生产环境。
