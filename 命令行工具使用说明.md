# ğŸ› ï¸ æŠ–éŸ³è§†é¢‘å¤„ç†å‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨è¯´æ˜

æœ¬é¡¹ç›®æä¾›äº†ä¸€å¥—å®Œæ•´çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥åœ¨ä¸å¯åŠ¨ HTTP æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œç›´æ¥é€šè¿‡å‘½ä»¤è¡Œå¤„ç†æŠ–éŸ³è§†é¢‘ã€‚

## ğŸ“‹ å·¥å…·æ¦‚è§ˆ

| å·¥å…·åç§°             | åŠŸèƒ½æè¿°     | ä¸»è¦ç”¨é€”             |
| -------------------- | ------------ | -------------------- |
| `douyin.js`          | ä¸»è¦å·¥å…·å…¥å£ | ç»Ÿä¸€çš„å‘½ä»¤è¡Œç•Œé¢     |
| `douyin-to-text.js`  | è§†é¢‘è½¬æ–‡æœ¬   | æå–è§†é¢‘ä¸­çš„è¯­éŸ³æ–‡æœ¬ |
| `douyin-download.js` | è§†é¢‘ä¸‹è½½     | ä¸‹è½½æ— æ°´å°è§†é¢‘       |
| `douyin-batch.js`    | æ‰¹é‡å¤„ç†     | æ‰¹é‡ä¸‹è½½æˆ–è½¬æ–‡æœ¬     |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# ç¡®ä¿å·²å®‰è£…ä¾èµ–
npm install

# ç¼–è¯‘TypeScriptä»£ç 
npm run build

# è®¾ç½®APIå¯†é’¥ï¼ˆæ–‡æœ¬æå–åŠŸèƒ½éœ€è¦ï¼‰
export SPEECH_API_KEY="your-siliconflow-api-key"

# æ£€æŸ¥ç¯å¢ƒçŠ¶æ€
node scripts/douyin.js status
```

### 2. åŸºæœ¬ä½¿ç”¨

```bash
# æŸ¥çœ‹ä¸»è¦å¸®åŠ©
node scripts/douyin.js

# ä¸‹è½½è§†é¢‘
node scripts/douyin.js download "https://v.douyin.com/xxx"

# æå–æ–‡æœ¬
node scripts/douyin.js to-text "https://v.douyin.com/xxx"

# æ‰¹é‡å¤„ç†
node scripts/douyin.js batch example-links.txt
```

## ğŸ“ è¯¦ç»†åŠŸèƒ½è¯´æ˜

### 1. ä¸»å·¥å…· (douyin.js)

ç»Ÿä¸€çš„å‘½ä»¤è¡Œå…¥å£ï¼Œæä¾›ç¯å¢ƒæ£€æŸ¥å’Œå­å‘½ä»¤è°ƒç”¨ã€‚

```bash
# åŸºæœ¬è¯­æ³•
node scripts/douyin.js <å‘½ä»¤> [å‚æ•°]

# å¯ç”¨å‘½ä»¤
to-text     # è§†é¢‘è½¬æ–‡æœ¬
download    # è§†é¢‘ä¸‹è½½
batch       # æ‰¹é‡å¤„ç†
help        # å¸®åŠ©ä¿¡æ¯
status      # ç¯å¢ƒæ£€æŸ¥
```

**ç¤ºä¾‹**:

```bash
# æ£€æŸ¥ç¯å¢ƒçŠ¶æ€
node scripts/douyin.js status

# è·å–å‘½ä»¤å¸®åŠ©
node scripts/douyin.js help download
```

### 2. è§†é¢‘è½¬æ–‡æœ¬å·¥å…· (douyin-to-text.js)

å°†æŠ–éŸ³è§†é¢‘ä¸­çš„è¯­éŸ³è½¬æ¢ä¸ºæ–‡æœ¬ã€‚

```bash
# åŸºæœ¬è¯­æ³•
node scripts/douyin-to-text.js <æŠ–éŸ³é“¾æ¥> [é€‰é¡¹]

# é€‰é¡¹
-o, --output <æ–‡ä»¶>    ä¿å­˜ç»“æœåˆ°æ–‡ä»¶ (.txt æˆ– .json)
-h, --help            æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

**ç¤ºä¾‹**:

```bash
# åŸºç¡€è½¬æ–‡æœ¬
node scripts/douyin-to-text.js "https://v.douyin.com/xxx"

# ä¿å­˜ä¸ºæ–‡æœ¬æ–‡ä»¶
node scripts/douyin-to-text.js "https://v.douyin.com/xxx" -o result.txt

# ä¿å­˜ä¸ºJSONæ–‡ä»¶
node scripts/douyin-to-text.js "https://v.douyin.com/xxx" -o result.json
```

**è¾“å‡ºæ ¼å¼**:

- æ§åˆ¶å°ï¼šå½©è‰²è¿›åº¦æ˜¾ç¤º + æœ€ç»ˆæ–‡æœ¬ç»“æœ
- æ–‡æœ¬æ–‡ä»¶ï¼šåŒ…å«è§†é¢‘ä¿¡æ¯å’Œæå–çš„æ–‡æœ¬
- JSON æ–‡ä»¶ï¼šç»“æ„åŒ–æ•°æ®ï¼ŒåŒ…å«å®Œæ•´ä¿¡æ¯

### 3. è§†é¢‘ä¸‹è½½å·¥å…· (douyin-download.js)

ä¸‹è½½æŠ–éŸ³æ— æ°´å°è§†é¢‘ã€‚

```bash
# åŸºæœ¬è¯­æ³•
node scripts/douyin-download.js <æŠ–éŸ³é“¾æ¥> [é€‰é¡¹]

# é€‰é¡¹
-o, --output <è·¯å¾„>    æŒ‡å®šè¾“å‡ºæ–‡ä»¶æˆ–ç›®å½•
-l, --link-only       ä»…è·å–ä¸‹è½½é“¾æ¥ï¼Œä¸å®é™…ä¸‹è½½
-h, --help           æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

**ç¤ºä¾‹**:

```bash
# ä¸‹è½½åˆ°å½“å‰ç›®å½•
node scripts/douyin-download.js "https://v.douyin.com/xxx"

# æŒ‡å®šæ–‡ä»¶å
node scripts/douyin-download.js "https://v.douyin.com/xxx" -o "my_video.mp4"

# æŒ‡å®šç›®å½•
node scripts/douyin-download.js "https://v.douyin.com/xxx" -o "./downloads/"

# ä»…è·å–ä¸‹è½½é“¾æ¥
node scripts/douyin-download.js "https://v.douyin.com/xxx" --link-only
```

### 4. æ‰¹é‡å¤„ç†å·¥å…· (douyin-batch.js)

æ‰¹é‡å¤„ç†å¤šä¸ªæŠ–éŸ³è§†é¢‘ã€‚

```bash
# åŸºæœ¬è¯­æ³•
node scripts/douyin-batch.js <é“¾æ¥æ–‡ä»¶> [é€‰é¡¹]

# é€‰é¡¹
-m, --mode <æ¨¡å¼>     å¤„ç†æ¨¡å¼: download, text, both (é»˜è®¤: both)
-o, --output <ç›®å½•>   æŒ‡å®šè¾“å‡ºç›®å½•
-d, --delay <æ¯«ç§’>    è¯·æ±‚é—´éš”å»¶è¿Ÿ (é»˜è®¤: 2000ms)
-h, --help           æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

**å¤„ç†æ¨¡å¼**:

- `download`: ä»…ä¸‹è½½è§†é¢‘
- `text`: ä»…æå–æ–‡æœ¬ï¼ˆéœ€è¦ API å¯†é’¥ï¼‰
- `both`: ä¸‹è½½è§†é¢‘å¹¶æå–æ–‡æœ¬

**é“¾æ¥æ–‡ä»¶æ ¼å¼**:

```
# è¿™æ˜¯æ³¨é‡Šè¡Œ
https://v.douyin.com/video1
https://v.douyin.com/video2
https://v.douyin.com/video3
```

**ç¤ºä¾‹**:

```bash
# æ‰¹é‡ä¸‹è½½
node scripts/douyin-batch.js links.txt -m download -o ./downloads

# æ‰¹é‡æå–æ–‡æœ¬
node scripts/douyin-batch.js links.txt -m text

# å®Œæ•´æ‰¹é‡å¤„ç†
node scripts/douyin-batch.js links.txt -m both -o ./output

# è®¾ç½®è¯·æ±‚å»¶è¿Ÿ
node scripts/douyin-batch.js links.txt -d 3000
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ

### åœºæ™¯ 1: å•ä¸ªè§†é¢‘å¤„ç†

```bash
# å¿«é€Ÿä¸‹è½½ä¸€ä¸ªè§†é¢‘
node scripts/douyin.js download "https://v.douyin.com/xxx"

# æå–è§†é¢‘æ–‡æœ¬å¹¶ä¿å­˜
node scripts/douyin.js to-text "https://v.douyin.com/xxx" -o transcription.txt
```

### åœºæ™¯ 2: æ‰¹é‡å†…å®¹åˆ†æ

```bash
# 1. å‡†å¤‡é“¾æ¥æ–‡ä»¶
echo "https://v.douyin.com/video1" > analysis_list.txt
echo "https://v.douyin.com/video2" >> analysis_list.txt

# 2. æ‰¹é‡æå–æ–‡æœ¬
node scripts/douyin.js batch analysis_list.txt -m text -o ./analysis_results

# 3. æŸ¥çœ‹ç”Ÿæˆçš„æ‘˜è¦
cat analysis_results/text_summary.txt
```

### åœºæ™¯ 3: å†…å®¹å¤‡ä»½

```bash
# æ‰¹é‡ä¸‹è½½å¹¶æå–æ–‡æœ¬ï¼Œå®Œæ•´å¤‡ä»½
node scripts/douyin.js batch backup_list.txt -m both -o ./backup_$(date +%Y%m%d)
```

## ğŸ“Š è¾“å‡ºæ–‡ä»¶è¯´æ˜

### å•ä¸ªå¤„ç†è¾“å‡º

**æ–‡æœ¬æ–‡ä»¶ (.txt)**:

```
è§†é¢‘æ ‡é¢˜: ç¤ºä¾‹è§†é¢‘æ ‡é¢˜
è§†é¢‘ID: 7234567890123456789
æè¿°: è§†é¢‘æè¿°ä¿¡æ¯
æå–æ—¶é—´: 2024-01-01T12:00:00.000Z

æå–çš„æ–‡æœ¬å†…å®¹:
è¿™é‡Œæ˜¯ä»è§†é¢‘ä¸­æå–çš„æ–‡æœ¬å†…å®¹...
```

**JSON æ–‡ä»¶ (.json)**:

```json
{
  "timestamp": "2024-01-01T12:00:00.000Z",
  "videoInfo": {
    "videoId": "7234567890123456789",
    "title": "ç¤ºä¾‹è§†é¢‘æ ‡é¢˜",
    "downloadUrl": "https://...",
    "desc": "è§†é¢‘æè¿°"
  },
  "extractedText": "æå–çš„æ–‡æœ¬å†…å®¹..."
}
```

### æ‰¹é‡å¤„ç†è¾“å‡º

**å¤„ç†æŠ¥å‘Š (batch_report.json)**:

```json
{
  "timestamp": "2024-01-01T12:00:00.000Z",
  "summary": {
    "total": 10,
    "success": 8,
    "failure": 2,
    "duration": 300
  },
  "results": [...]
}
```

**æ–‡æœ¬æ‘˜è¦ (text_summary.txt)**:

```
æŠ–éŸ³è§†é¢‘æ–‡æœ¬æå–æ‘˜è¦
ç”Ÿæˆæ—¶é—´: 2024-01-01 12:00:00

1. è§†é¢‘æ ‡é¢˜1
   è§†é¢‘ID: 7234567890123456789
   æå–æ–‡æœ¬: æ–‡æœ¬å†…å®¹1...

2. è§†é¢‘æ ‡é¢˜2
   è§†é¢‘ID: 7234567890123456790
   æå–æ–‡æœ¬: æ–‡æœ¬å†…å®¹2...
```

## âš™ï¸ ç¯å¢ƒå˜é‡é…ç½®

| å˜é‡å                | è¯´æ˜              | å¿…éœ€         | é»˜è®¤å€¼               |
| --------------------- | ----------------- | ------------ | -------------------- |
| `SPEECH_API_KEY`      | è¯­éŸ³è¯†åˆ« API å¯†é’¥ | æ–‡æœ¬æå–å¿…éœ€ | æ—                    |
| `SPEECH_API_BASE_URL` | API æœåŠ¡åœ°å€      | å¦           | SiliconFlow é»˜è®¤åœ°å€ |
| `SPEECH_MODEL`        | è¯­éŸ³è¯†åˆ«æ¨¡å‹      | å¦           | SenseVoiceSmall      |
| `TEMP_DIR`            | ä¸´æ—¶æ–‡ä»¶ç›®å½•      | å¦           | ./temp               |
| `LOG_LEVEL`           | æ—¥å¿—çº§åˆ«          | å¦           | info                 |

**è®¾ç½®æ–¹å¼**:

```bash
# ä¸´æ—¶è®¾ç½®
export SPEECH_API_KEY="your-api-key"

# æ°¸ä¹…è®¾ç½® (æ·»åŠ åˆ° .bashrc æˆ– .zshrc)
echo 'export SPEECH_API_KEY="your-api-key"' >> ~/.bashrc

# ä½¿ç”¨ .env æ–‡ä»¶
echo "SPEECH_API_KEY=your-api-key" >> .env
```

## ğŸš¨ å¸¸è§é—®é¢˜ä¸è§£å†³

### 1. é¡¹ç›®æœªç¼–è¯‘é”™è¯¯

```bash
âŒ é¡¹ç›®æœªç¼–è¯‘ï¼Œè¯·å…ˆè¿è¡Œ: npm run build
```

**è§£å†³**:

```bash
npm run build
```

### 2. API å¯†é’¥æœªè®¾ç½®

```bash
âŒ SPEECH_API_KEY ç¯å¢ƒå˜é‡æœªè®¾ç½®
```

**è§£å†³**:

```bash
export SPEECH_API_KEY="your-siliconflow-api-key"
```

### 3. FFmpeg æœªå®‰è£…

```bash
âŒ FFmpeg: æœªå®‰è£…
```

**è§£å†³**:

```bash
# macOS
brew install ffmpeg

# Ubuntu/Debian
sudo apt install ffmpeg

# Windows
# ä¸‹è½½å¹¶å®‰è£… FFmpegï¼Œæ·»åŠ åˆ°PATH
```

### 4. ç½‘ç»œè¿æ¥é—®é¢˜

```bash
âŒ è§£ææŠ–éŸ³é“¾æ¥å¤±è´¥: ç½‘ç»œè¯·æ±‚è¶…æ—¶
```

**è§£å†³**:

- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ä½¿ç”¨ç§‘å­¦ä¸Šç½‘å·¥å…·
- é‡è¯•æ“ä½œ

### 5. é“¾æ¥æ ¼å¼é”™è¯¯

```bash
âŒ è¯·æä¾›æœ‰æ•ˆçš„æŠ–éŸ³åˆ†äº«é“¾æ¥
```

**è§£å†³**:

- ç¡®ä¿é“¾æ¥åŒ…å« `douyin.com`
- ä½¿ç”¨æœ€æ–°çš„åˆ†äº«é“¾æ¥
- æ£€æŸ¥é“¾æ¥æ˜¯å¦å®Œæ•´

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ‰¹é‡å¤„ç†ä¼˜åŒ–

```bash
# é€‚å½“è®¾ç½®å»¶è¿Ÿï¼Œé¿å…è¯·æ±‚è¿‡äºé¢‘ç¹
node scripts/douyin-batch.js links.txt -d 3000

# å…ˆæµ‹è¯•å°æ‰¹é‡ï¼Œå†å¤„ç†å¤§é‡æ•°æ®
head -5 links.txt > test_links.txt
node scripts/douyin-batch.js test_links.txt
```

### 2. å­˜å‚¨ç©ºé—´ç®¡ç†

```bash
# å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -rf temp/*

# ä½¿ç”¨ä¸“é—¨çš„è¾“å‡ºç›®å½•
mkdir -p downloads/$(date +%Y%m%d)
node scripts/douyin-batch.js links.txt -o downloads/$(date +%Y%m%d)
```

### 3. å¹¶å‘å¤„ç†

æ‰¹é‡å·¥å…·ç›®å‰æ˜¯ä¸²è¡Œå¤„ç†ï¼Œå¦‚éœ€å¹¶å‘å¤„ç†å¤§é‡è§†é¢‘ï¼Œå¯ä»¥ï¼š

```bash
# åˆ†å‰²é“¾æ¥æ–‡ä»¶
split -l 10 large_links.txt batch_

# å¹¶è¡Œå¤„ç†å¤šä¸ªæ–‡ä»¶
for file in batch_*; do
  node scripts/douyin-batch.js "$file" -o "output_$file" &
done
wait
```

## ğŸ”— é«˜çº§ç”¨æ³•

### 1. ç»“åˆå…¶ä»–å·¥å…·

```bash
# ä¸ jq ç»“åˆå¤„ç†JSONç»“æœ
node scripts/douyin-to-text.js "URL" -o result.json
cat result.json | jq '.extractedText'

# ä¸ grep æœç´¢æ–‡æœ¬å†…å®¹
node scripts/douyin-batch.js links.txt -m text
grep -r "å…³é”®è¯" ./text_summary.txt
```

### 2. è‡ªåŠ¨åŒ–è„šæœ¬

```bash
#!/bin/bash
# daily_douyin_backup.sh

DATE=$(date +%Y%m%d)
OUTPUT_DIR="./backup_$DATE"

# æ‰¹é‡å¤„ç†å¹¶å¤‡ä»½
node scripts/douyin-batch.js daily_links.txt -m both -o "$OUTPUT_DIR"

# å‹ç¼©å¤‡ä»½
tar -czf "douyin_backup_$DATE.tar.gz" "$OUTPUT_DIR"

echo "å¤‡ä»½å®Œæˆ: douyin_backup_$DATE.tar.gz"
```

### 3. ç›‘æ§å’Œæ—¥å¿—

```bash
# é‡å®šå‘è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶
node scripts/douyin-batch.js links.txt 2>&1 | tee process.log

# åªä¿å­˜é”™è¯¯ä¿¡æ¯
node scripts/douyin-batch.js links.txt 2> errors.log
```

---

ğŸ’¡ **æç¤º**: è¿™äº›å‘½ä»¤è¡Œå·¥å…·æä¾›äº†çµæ´»ä¸”å¼ºå¤§çš„æŠ–éŸ³è§†é¢‘å¤„ç†èƒ½åŠ›ï¼Œæ— éœ€å¯åŠ¨ HTTP æœåŠ¡å™¨å³å¯ä½¿ç”¨ã€‚å»ºè®®æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·å’Œå‚æ•°ã€‚
