# Node.js vs Python 版本技术对比

## 项目概述对比

| 特性         | Python 版本                  | Node.js 版本        |
| ------------ | ---------------------------- | ------------------- |
| **协议**     | MCP (Model Context Protocol) | HTTP REST API       |
| **使用场景** | Claude Desktop 集成          | 独立 API 服务       |
| **部署方式** | uvx 包管理                   | Docker/PM2/直接部署 |
| **接口类型** | MCP 工具函数                 | RESTful API         |

## 技术架构对比

### Python 版本 (MCP)

```
Claude Desktop
    ↓
MCP Protocol
    ↓
FastMCP Server
    ↓
DouyinProcessor 类
```

### Node.js 版本 (REST API)

```
HTTP 客户端
    ↓
Express.js Server
    ↓
Controller → Service → Utils
```

## 核心功能实现对比

### 1. 链接解析

**Python 版本**:

```python
def parse_share_url(self, share_text: str) -> dict:
    # 正则提取URL
    urls = re.findall(r'http[s]?://...', share_text)
    # 请求重定向获取视频ID
    share_response = requests.get(share_url, headers=HEADERS)
    video_id = share_response.url.split("/")[-1]
```

**Node.js 版本**:

```typescript
async parseShareUrl(shareText: string): Promise<DouyinVideoInfo> {
    // 正则提取URL
    const urls = shareText.match(urlRegex);
    // Axios 请求处理重定向
    const shareResponse = await axios.get(shareUrl, {
        headers: { 'User-Agent': this.userAgent },
        maxRedirects: 5,
    });
}
```

### 2. 视频下载

**Python 版本**:

```python
async def download_video(self, video_info: dict, ctx: Context) -> Path:
    response = requests.get(video_info['url'], headers=HEADERS, stream=True)
    with open(filepath, 'wb') as f:
        for chunk in response.iter_content(chunk_size=8192):
            # 进度通过 ctx.report_progress 报告
```

**Node.js 版本**:

```typescript
async downloadVideo(videoInfo: DouyinVideoInfo,
    progressCallback?: (progress: ProcessingProgress) => void
): Promise<string> {
    const response = await axios({
        method: 'GET', url: videoInfo.downloadUrl,
        responseType: 'stream',
    });
    // Stream 处理，通过回调函数报告进度
}
```

### 3. 音频提取

**Python 版本**:

```python
def extract_audio(self, video_path: Path) -> Path:
    (ffmpeg.input(str(video_path))
     .output(str(audio_path), acodec='libmp3lame', q=0)
     .run(capture_stdout=True, capture_stderr=True, overwrite_output=True))
```

**Node.js 版本**:

```typescript
async extractAudio(videoPath: string,
    progressCallback?: (progress: ProcessingProgress) => void
): Promise<string> {
    return new Promise((resolve, reject) => {
        ffmpeg(videoPath)
            .audioCodec('libmp3lame')
            .audioQuality(0)
            .on('progress', (progress) => {
                // 实时进度回调
            })
            .save(audioPath);
    });
}
```

## 优势对比

### Python 版本优势

1. **MCP 协议集成**

   - 直接与 Claude Desktop 集成
   - 无需独立服务器
   - 工具函数式调用

2. **简洁的部署**

   - `uvx douyin-mcp-server` 一键启动
   - 包管理器自动处理

3. **上下文集成**
   - 与 AI 工具深度集成
   - 进度通过 MCP 协议报告

### Node.js 版本优势

1. **更好的并发性能**

   - 事件驱动异步 I/O
   - 适合高并发请求
   - 非阻塞文件操作

2. **丰富的 Web 生态**

   - Express.js 成熟框架
   - 完整的 HTTP 服务功能
   - 中间件生态丰富

3. **更好的可扩展性**

   - RESTful API 标准
   - 支持多种客户端
   - 容易集成其他系统

4. **强类型支持**

   - TypeScript 提供类型安全
   - 更好的代码提示
   - 编译时错误检查

5. **容器化友好**
   - Docker 部署简单
   - 微服务架构支持
   - 负载均衡容易实现

## 性能对比

| 指标           | Python 版本           | Node.js 版本         |
| -------------- | --------------------- | -------------------- |
| **并发处理**   | 同步为主，受 GIL 限制 | 异步事件循环，高并发 |
| **内存使用**   | 较高                  | 相对较低             |
| **启动速度**   | 快                    | 很快                 |
| **CPU 密集型** | 较好                  | 一般                 |
| **I/O 密集型** | 一般                  | 很好                 |

## 使用场景建议

### 选择 Python 版本的情况

- 主要在 Claude Desktop 中使用
- 个人或小团队使用
- 不需要高并发访问
- 希望与 AI 工具深度集成

### 选择 Node.js 版本的情况

- 需要独立的 API 服务
- 高并发访问需求
- 与其他系统集成
- 团队开发，需要标准化 API
- 容器化部署
- 微服务架构

## 迁移指南

### 从 Python 到 Node.js

1. **接口调用方式变化**

   ```python
   # Python MCP 调用
   extract_douyin_text("https://v.douyin.com/xxx")
   ```

   ```javascript
   // Node.js REST API 调用
   fetch("/api/extract-text", {
     method: "POST",
     headers: { "Content-Type": "application/json" },
     body: JSON.stringify({ shareLink: "https://v.douyin.com/xxx" }),
   });
   ```

2. **配置方式变化**

   ```json
   // Claude Desktop 配置
   {
     "mcpServers": {
       "douyin-mcp": {
         "command": "uvx",
         "args": ["douyin-mcp-server"],
         "env": { "DOUYIN_API_KEY": "key" }
       }
     }
   }
   ```

   ```env
   # Node.js 环境变量
   SPEECH_API_KEY=your-api-key
   PORT=3000
   NODE_ENV=production
   ```

3. **部署方式变化**

   ```bash
   # Python 部署
   uvx douyin-mcp-server

   # Node.js 部署
   npm run build
   npm start
   # 或
   docker-compose up -d
   ```

## 技术栈总结

### Python 版本技术栈

- **语言**: Python 3.8+
- **框架**: FastMCP
- **协议**: MCP (Model Context Protocol)
- **依赖**: requests, ffmpeg-python, tqdm
- **部署**: uvx 包管理器

### Node.js 版本技术栈

- **语言**: TypeScript
- **运行时**: Node.js 16+
- **框架**: Express.js
- **协议**: HTTP REST API
- **依赖**: axios, fluent-ffmpeg, winston, joi
- **部署**: Docker, PM2, 直接运行

## 结论

两个版本各有优势，选择哪个版本取决于具体的使用场景：

- **Python 版本**：适合与 AI 工具深度集成的场景
- **Node.js 版本**：适合作为独立 API 服务，支持更广泛的应用场景

Node.js 版本在并发性能、可扩展性和部署灵活性方面更有优势，而 Python 版本在 AI 工具集成方面更加便捷。
